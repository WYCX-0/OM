{"version":3,"file":"rtestOrder.js","sources":["pages/rtestOrder/rtestOrder.vue","../../software/Hbuilder/HBuilderX.4.45.2025010502/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcnRlc3RPcmRlci9ydGVzdE9yZGVyLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"container\">\r\n\t\t\t<view class=\"map-container\">\r\n\t\t\t\t<map id=\"mapContainer\" style=\"width:100%;height:300rpx\" :markers=\"markers\" :circles=\"circles\"\r\n\t\t\t\t\t:show-location=\"true\" @regionchange=\"onRegionChange\"></map>\r\n\t\t\t</view>\r\n\t\t\t<!-- 设备名称 -->\r\n\t\t\t<view class=\"detail-card\">\r\n\t\t\t\t<view class=\"detail-header\">\r\n\t\t\t\t\t<text class=\"detail-label\">设备名称:</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"detail-content\">\r\n\t\t\t\t\t<text class=\"detail-value\">{{ deviceName }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"detail-card\">\r\n\t\t\t\t<view class=\"detail-header\">\r\n\t\t\t\t\t<text class=\"detail-label\">创建时间:</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"detail-content\">\r\n\t\t\t\t\t<text class=\"detail-value\">{{ formatBasicDate(detailData.createTime) }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 上传图片 (仅当状态为处理中时显示) -->\r\n\t\t\t<view v-if=\"detailData.status === 2 && countdown === 0\" class=\"detail-card\">\r\n\t\t\t\t<view class=\"detail-header\">\r\n\t\t\t\t\t<text class=\"detail-label\">上传巡检图片</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"detail-content\">\r\n\t\t\t\t\t<view class=\"upload-container\">\r\n\t\t\t\t\t\t<view class=\"upload-area\" @click=\"chooseImage\">\r\n\t\t\t\t\t\t\t<text class=\"upload-text\">点击上传图片</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view v-if=\"repairImageUrl\" class=\"repair-image-container\">\r\n\t\t\t\t\t\t\t<image :src=\"repairImageUrl\" mode=\"widthFix\" class=\"repair-image\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 处理按钮 (仅当状态为待处理时显示) -->\r\n\t\t\t<view v-if=\"detailData.status === 1\" class=\"action-button-container\">\r\n\t\t\t\t<button class=\"action-button\" hover-class=\"action-button-hover\" @click=\"startProcessing\">\r\n\t\t\t\t\t开始处理\r\n\t\t\t\t</button>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 正常异常单选框 (仅当状态为处理中时显示) -->\r\n\t\t\t<view v-if=\"detailData.status === 2&& countdown === 0\" class=\"action-button-container\">\r\n\t\t\t\t<radio-group @change=\"onRadioChange\">\r\n\t\t\t\t\t<label>\r\n\t\t\t\t\t\t<radio value=\"1\" :checked=\"current === '1'\" /> 正常\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<label>\r\n\t\t\t\t\t\t<radio value=\"0\" :checked=\"current === '0'\" /> 异常\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</radio-group>\r\n\t\t\t</view>\r\n\r\n\t\t\t<view v-if=\"detailData.status === 3\" class=\"action-button-container\">\r\n\t\t\t\t<view class=\"detail-header\">\r\n\t\t\t\t\t<text class=\"detail-label\">设备状态:</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"detail-content\">\r\n\t\t\t\t\t<text class=\"detail-value\" v-if=\"detailData.current === 1\">正常</text>\r\n\t\t\t\t\t<text class=\"detail-value\" v-if=\"detailData.current === 0\">异常</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 新增倒计时显示 -->\r\n\t\t\t<view v-if=\"countdown > 0\" class=\"countdown-container\">\r\n\t\t\t\t<text class=\"countdown-text\">剩余时间: {{ formatCountdown }}</text>\r\n\t\t\t</view>\r\n\r\n\t\t\t<!-- 修改后的完成维修按钮 -->\r\n\t\t\t<view v-if=\"detailData.status === 2 && countdown === 0\" class=\"action-button-container\">\r\n\t\t\t\t<button class=\"action-button\" hover-class=\"action-button-hover\" @click=\"completeRepair\">\r\n\t\t\t\t\t完成检测\r\n\t\t\t\t</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tbaseConfig\r\n\t} from '../../utils/config';\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tdetailData: {\r\n\t\t\t\t\tid: '',\r\n\t\t\t\t\tdeviceId: '',\r\n\t\t\t\t\tcreateTime: '',\r\n\t\t\t\t\tstatus: 0,\r\n\t\t\t\t\tcurrent: ''\r\n\t\t\t\t},\r\n\t\t\t\trepairImageUrl: '',\r\n\t\t\t\tfinishUrl: '',\r\n\t\t\t\tdeviceName: '',\r\n\t\t\t\tdeviceOptions: [],\r\n\t\t\t\ttoken: '',\r\n\t\t\t\tcurrent: '', // 新增变量用于存储单选框的值\r\n\t\t\t\t// 新增数据项\r\n\t\t\t\tcountdown: 5, // 3分钟倒计时（单位：秒）\r\n\t\t\t\ttimer: null, // 倒计时定时器\r\n\t\t\t\tlocationInterval: null, // 定位检查定时器\r\n\t\t\t\tfenceCenter: null, // 围栏中心坐标 [lng, lat]\r\n\t\t\t\tfenceRadius: null, // 围栏半径（米）\r\n\t\t\t\t// 新增地图相关数据\r\n\t\t\t\tmarkers: [],\r\n\t\t\t\tcircles: [],\r\n\t\t\t\tuserLocation: null,\r\n\t\t\t\tmapCtx: null,\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\t// 从URL参数中获取数据\r\n\t\t\tif (options.detailData) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tthis.getAccessToken();\r\n\t\t\t\t\tthis.detailData = JSON.parse(decodeURIComponent(options.detailData));\r\n\t\t\t\t\tthis.getDeviceOptions(); // 获取设备选项\r\n\t\t\t\t\tthis.getFenceInfo();\r\n\t\t\t\t\tconsole.log(this.detailData);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('解析详情数据失败', e);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '数据加载失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\tthis.mapCtx = uni.createMapContext('mapContainer', this);\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.getFenceInfo();\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\t// 页面卸载时清理定时器\r\n\t\t\tif (this.timer) clearInterval(this.timer);\r\n\t\t\tif (this.locationInterval) clearInterval(this.locationInterval);\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t// 正确声明计算属性\r\n\t\t\tformatCountdown() {\r\n\t\t\t\tconst minutes = Math.floor(this.countdown / 60);\r\n\t\t\t\tconst seconds = this.countdown % 60;\r\n\t\t\t\treturn `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tasync startProcessing() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst confirmResult = await new Promise((resolve) => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '确认处理',\r\n\t\t\t\t\t\t\tcontent: '确定要开始处理该设备问题吗？',\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tresolve(res);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (confirmResult.confirm) {\r\n\t\t\t\t\t\t// 检查定位权限\r\n\t\t\t\t\t\tconst hasPermission = await this.checkAndroidPermission();\r\n\t\t\t\t\t\tif (!hasPermission) return;\r\n\r\n\t\t\t\t\t\t// 获取当前位置\r\n\t\t\t\t\t\tconst location = await this.getCurrentLocation();\r\n\t\t\t\t\t\tconst isInside = await this.checkInFence(location);\r\n\t\t\t\t\t\tif (!isInside) {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\tcontent: '您不在电子围栏范围内，请移步',\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst requestResult = await new Promise((resolve, reject) => {\r\n\t\t\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\t\t\turl: `${baseConfig.baseUrl}/engineer/rtestOrder/deal/${this.detailData.id}`,\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t\t'Authorization': `Bearer ${this.token}`\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tresolve(res);\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tif (requestResult.data.code === 200) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '开始处理',\r\n\t\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tthis.updateStatus(2);\r\n\r\n\t\t\t\t\t\t\t// 1. 获取围栏信息\r\n\t\t\t\t\t\t\tthis.getFenceInfo();\r\n\r\n\t\t\t\t\t\t\t// 4. 启动围栏检测\r\n\t\t\t\t\t\t\tthis.startLocationCheck();\r\n\t\t\t\t\t\t} else if (requestResult.data.code === 0) {\r\n\t\t\t\t\t\t\t// 根据后端返回的错误信息显示相应的弹框\r\n\t\t\t\t\t\t\tconst errorMessage = requestResult.data.msg;\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\tcontent: errorMessage,\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('处理过程中出现错误:', error);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '处理失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 安卓权限检查\r\n\t\t\tasync checkAndroidPermission() {\r\n\t\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\t\tif (typeof plus !== 'undefined' && plus.os.name === 'Android') {\r\n\t\t\t\t\t\tplus.android.requestPermissions(\r\n\t\t\t\t\t\t\t['android.permission.ACCESS_FINE_LOCATION'],\r\n\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\t\t\t\t\tsuccess: () => resolve(true),\r\n\t\t\t\t\t\t\t\t\tfail: () => resolve(false)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t() => resolve(false)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\t\t\tsuccess: () => resolve(true),\r\n\t\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\ttitle: '需要位置权限',\r\n\t\t\t\t\t\t\t\t\tcontent: '请在设置中开启定位服务',\r\n\t\t\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\t\t\tsuccess: () => resolve(false)\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 初始化地图覆盖物\r\n\t\t\tinitMapOverlays() {\r\n\t\t\t\tif (!this.fenceCenter) return;\r\n\r\n\t\t\t\t// 围栏中心标记\r\n\t\t\t\tconst fenceMarker = {\r\n\t\t\t\t\tid: 0,\r\n\t\t\t\t\tlatitude: this.fenceCenter[1],\r\n\t\t\t\t\tlongitude: this.fenceCenter[0],\r\n\t\t\t\t\ttitle: '设备位置',\r\n\t\t\t\t\ticonPath: '/static/fence-marker.png',\r\n\t\t\t\t\twidth: 30,\r\n\t\t\t\t\theight: 30\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// 围栏范围圆圈\r\n\t\t\t\tconst fenceCircle = {\r\n\t\t\t\t\tlatitude: this.fenceCenter[1],\r\n\t\t\t\t\tlongitude: this.fenceCenter[0],\r\n\t\t\t\t\tradius: this.fenceRadius,\r\n\t\t\t\t\tstrokeWidth: 2,\r\n\t\t\t\t\tstrokeColor: '#FF0000',\r\n\t\t\t\t\tfillColor: '#FF000022'\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// 用户位置标记\r\n\t\t\t\tconst userMarker = {\r\n\t\t\t\t\tid: 1,\r\n\t\t\t\t\tlatitude: this.userLocation?.latitude,\r\n\t\t\t\t\tlongitude: this.userLocation?.longitude,\r\n\t\t\t\t\ttitle: '我的位置',\r\n\t\t\t\t\ticonPath: '/static/user-marker.png',\r\n\t\t\t\t\twidth: 20,\r\n\t\t\t\t\theight: 20,\r\n\t\t\t\t\trotate: 0\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis.markers = [fenceMarker, userMarker].filter(Boolean);\r\n\t\t\t\tthis.circles = [fenceCircle];\r\n\t\t\t},\r\n\t\t\t// 更新用户位置标记\r\n\t\t\tasync updateUserPosition() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst location = await this.getCurrentLocation();\r\n\t\t\t\t\tthis.userLocation = location;\r\n\t\t\t\t\tthis.initMapOverlays();\r\n\r\n\t\t\t\t\t// 自动调整地图视野\r\n\t\t\t\t\tthis.mapCtx.includePoints({\r\n\t\t\t\t\t\tpoints: [{\r\n\t\t\t\t\t\t\t\tlatitude: this.fenceCenter[1],\r\n\t\t\t\t\t\t\t\tlongitude: this.fenceCenter[0]\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tlatitude: location.latitude,\r\n\t\t\t\t\t\t\t\tlongitude: location.longitude\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\tpadding: [50, 50, 50, 50]\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('获取位置失败:', error);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 定位检查方法\r\n\t\t\tasync checkLocation() {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst location = await this.getCurrentLocation();\r\n\t\t\t\t\tconst isInside = await this.checkInFence(location);\r\n\t\t\t\t\tif (isInside) {\r\n\t\t\t\t\t\tif (!this.timer) {\r\n\t\t\t\t\t\t\tthis.startCountdown();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.resetCountdown();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.updateUserPosition(); // 更新地图显示\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error('检查位置时出错:', error);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 检查是否在围栏内\r\n\t\t\tcheckInFence(location) {\r\n\t\t\t\tif (!this.fenceCenter) return false;\r\n\r\n\t\t\t\tconst [lng1, lat1] = this.fenceCenter;\r\n\t\t\t\tconst lng2 = location.longitude;\r\n\t\t\t\tconst lat2 = location.latitude;\r\n\r\n\t\t\t\tconst distance = this.calculateDistance(lat1, lng1, lat2, lng2);\r\n\t\t\t\treturn distance <= this.fenceRadius;\r\n\t\t\t},\r\n\t\t\t// 计算距离（Haversine公式）\r\n\t\t\tcalculateDistance(lat1, lng1, lat2, lng2) {\r\n\t\t\t\tconst toRad = d => d * Math.PI / 180;\r\n\t\t\t\tconst R = 6378137; // 地球半径（米）\r\n\r\n\t\t\t\tconst φ1 = toRad(lat1);\r\n\t\t\t\tconst φ2 = toRad(lat2);\r\n\t\t\t\tconst Δφ = toRad(lat2 - lat1);\r\n\t\t\t\tconst Δλ = toRad(lng2 - lng1);\r\n\r\n\t\t\t\tconst a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +\r\n\t\t\t\t\tMath.cos(φ1) * Math.cos(φ2) *\r\n\t\t\t\t\tMath.sin(Δλ / 2) * Math.sin(Δλ / 2);\r\n\t\t\t\tconst c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n\t\t\t\treturn R * c;\r\n\t\t\t},\r\n\t\t\t// 开始倒计时\r\n\t\t\tstartCountdown() {\r\n\t\t\t\tif (this.timer) return;\r\n\t\t\t\tthis.timer = setInterval(() => {\r\n\t\t\t\t\tif (this.countdown > 0) {\r\n\t\t\t\t\t\tthis.countdown--;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tclearInterval(this.timer);\r\n\t\t\t\t\t\tthis.timer = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 1000);\r\n\t\t\t},\r\n\t\t\t// 重置倒计时\r\n\t\t\tresetCountdown() {\r\n\t\t\t\tthis.countdown = 180;\r\n\t\t\t\tif (this.timer) {\r\n\t\t\t\t\tclearInterval(this.timer);\r\n\t\t\t\t\tthis.timer = null;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 修改后的获取围栏信息方法\r\n\t\t\tgetFenceInfo() {\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: `${baseConfig.baseUrl}/engineer/device/get/${this.detailData.deviceId}`,\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'Authorization': `Bearer ${this.token}`\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.data.code === 200) {\r\n\t\t\t\t\t\t\tthis.fenceCenter = [res.data.data.centerLng, res.data.data.centerLat];\r\n\t\t\t\t\t\t\tthis.fenceRadius = res.data.data.radius;\r\n\t\t\t\t\t\t\tthis.initMapOverlays();\r\n\t\t\t\t\t\t\tthis.updateUserPosition();\r\n\t\t\t\t\t\t\t// 确保地图组件初始化\r\n\t\t\t\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\t\t\t\tthis.mapCtx = uni.createMapContext('mapContainer', this);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 安卓地图显示\r\n\t\t\tshowFenceMap() {\r\n\t\t\t\tif (!this.fenceCenter || this.fenceCenter.length !== 2) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '无效的围栏坐标',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst [longitude, latitude] = this.fenceCenter;\r\n\t\t\t\tif (typeof plus !== 'undefined' && plus.maps) {\r\n\t\t\t\t\tconst map = new plus.maps.Map('mapContainer');\r\n\t\t\t\t\tmap.center = new plus.maps.LatLng(latitude, longitude);\r\n\t\t\t\t\tmap.zoom = 17;\r\n\r\n\t\t\t\t\t// 添加标记\r\n\t\t\t\t\tconst marker = new plus.maps.Marker(\r\n\t\t\t\t\t\tnew plus.maps.LatLng(latitude, longitude)\r\n\t\t\t\t\t);\r\n\t\t\t\t\tmap.addOverlay(marker);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '地图组件加载失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 检查位置\r\n\t\t\tstartLocationCheck() {\r\n\t\t\t\tif (this.locationInterval) return;\r\n\t\t\t\tthis.locationInterval = setInterval(async () => {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tawait this.checkLocation();\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.error('周期定位检查失败:', e);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 5000);\r\n\t\t\t},\r\n\t\t\t// 获取当前位置\r\n\t\t\tgetCurrentLocation() {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\tuni.getLocation({\r\n\t\t\t\t\t\ttype: 'gcj02',\r\n\t\t\t\t\t\tsuccess: resolve,\r\n\t\t\t\t\t\tfail: reject\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 在组件销毁时清除定时器\r\n\t\t\tbeforeDestroy() {\r\n\t\t\t\tif (this.timer) clearInterval(this.timer);\r\n\t\t\t\tif (this.locationInterval) clearInterval(this.locationInterval);\r\n\t\t\t},\r\n\t\t\tchooseImage() {\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: ['original', 'compressed'],\r\n\t\t\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t// 显示临时图片预览\r\n\t\t\t\t\t\tthis.repairImageUrl = res.tempFilePaths[0];\r\n\r\n\t\t\t\t\t\t// 执行上传\r\n\t\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\t\turl: `${baseConfig.baseUrl}/upload`,\r\n\t\t\t\t\t\t\tfilePath: res.tempFilePaths[0], // 注意这里用 filePath 不是 src\r\n\t\t\t\t\t\t\tname: 'file', // 必须与后端接收参数名一致\r\n\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t'Authorization': `Bearer ${this.token}`,\r\n\t\t\t\t\t\t\t\t'Content-Type': 'multipart/form-data' // 明确指定内容类型\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tsuccess: (uploadRes) => {\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tconst data = JSON.parse(uploadRes.data);\r\n\t\t\t\t\t\t\t\t\tif (data.code === 200) {\r\n\t\t\t\t\t\t\t\t\t\tthis.finishUrl = data\r\n\t\t\t\t\t\t\t\t\t\t\t.data; // 假设返回结构为 { code:200, data:\"url\" }\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: '上传失败: ' + data.msg,\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\tconsole.error('解析响应失败', e);\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '上传结果解析失败',\r\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tconsole.error('上传失败', err);\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: `上传失败: ${err.errMsg}`,\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tcompleteRepair() {\r\n\t\t\t\tif (!this.finishUrl) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '请先上传维修图片',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.current) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '请选择设备状态',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(\"finish:{}\", this.finishUrl);\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '确认完成',\r\n\t\t\t\t\tcontent: '确定已完成维修吗？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconsole.log(this.current);\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tuni.request({\r\n\t\t\t\t\t\t\t\turl: `${baseConfig.baseUrl}/engineer/rtestOrder/finish/${this.detailData.id}`,\r\n\t\t\t\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\t\t\t\theader: {\r\n\t\t\t\t\t\t\t\t\t'Authorization': `Bearer ${this.token}`,\r\n\t\t\t\t\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded'\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t// 添加 current 参数到请求数据中\r\n\t\t\t\t\t\t\t\tdata: `finishUrl=${encodeURIComponent(this.finishUrl)}&current=${this.current}`,\r\n\t\t\t\t\t\t\t\tsuccess: (response) => {\r\n\t\t\t\t\t\t\t\t\tif (response.data.code === 200) {\r\n\t\t\t\t\t\t\t\t\t\tthis.updateStatus(3); // 更新状态为已完成\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: '维修完成',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: '提交维修信息失败',\r\n\t\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: () => {\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '提交维修信息失败',\r\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tformatBasicDate(dateArray) {\r\n\t\t\t\tif (!dateArray || !Array.isArray(dateArray) || dateArray.length < 6) return '--';\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// 解构数组并处理月份（月份从0开始）\r\n\t\t\t\t\tconst [year, month, day, hours, minutes, seconds] = dateArray;\r\n\r\n\t\t\t\t\t// 补零函数\r\n\t\t\t\t\tconst padZero = num => String(num).padStart(2, '0');\r\n\r\n\t\t\t\t\t// 注意：月份需要减1\r\n\t\t\t\t\tconst date = new Date(year, month - 1, day, hours, minutes, seconds);\r\n\t\t\t\t\tif (isNaN(date.getTime())) return '--'; // 校验日期合法性\r\n\r\n\t\t\t\t\t// 拼接标准格式\r\n\t\t\t\t\treturn `${year}-${padZero(month)}-${padZero(day)} ` +\r\n\t\t\t\t\t\t`${padZero(hours)}:${padZero(minutes)}:${padZero(seconds)}`;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error('日期格式化失败:', e);\r\n\t\t\t\t\treturn '--';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgetAccessToken() {\r\n\t\t\t\tthis.token = uni.getStorageSync('token');\r\n\t\t\t},\r\n\t\t\tgetDeviceOptions() {\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: `${baseConfig.baseUrl}/engineer/device/get`,\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'Authorization': `Bearer ${this.token}` // 确保正确使用存储的 token\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.data.code === 200) {\r\n\t\t\t\t\t\t\tthis.deviceOptions = res.data.data.map(device => ({\r\n\t\t\t\t\t\t\t\tid: device.id,\r\n\t\t\t\t\t\t\t\tname: device.name\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t\tthis.updateDeviceName(); // 更新设备名称\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '获取设备列表失败',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tconsole.error('获取设备列表失败', err);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '获取设备列表失败，请检查网络连接',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tupdateDeviceName() {\r\n\t\t\t\tconst device = this.deviceOptions.find(item => item.id === this.detailData.deviceId);\r\n\t\t\t\tif (device) {\r\n\t\t\t\t\tthis.deviceName = device.name;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.deviceName = '未知设备';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgetStatusClass(status) {\r\n\t\t\t\tswitch (status) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\treturn 'status-cancel';\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\treturn 'status-pending';\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\treturn 'status-processing';\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\treturn 'status-complete';\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn '';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tgetStatusText(status) {\r\n\t\t\t\tswitch (status) {\r\n\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\treturn '已取消';\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\treturn '待处理';\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\treturn '处理中';\r\n\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\treturn '已完成';\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn '未知状态';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateStatus(newStatus) {\r\n\t\t\t\tthis.detailData.status = newStatus;\r\n\t\t\t\tconsole.log('状态已更新为:', this.getStatusText(newStatus));\r\n\t\t\t},\r\n\t\t\tonRadioChange(e) {\r\n\t\t\t\tthis.current = e.detail.value;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t/* 增强地图容器样式 */\r\n\t.map-container {\r\n\t\tmargin: 20rpx;\r\n\t\theight: 350rpx;\r\n\t\tborder-radius: 16rpx;\r\n\t\toverflow: hidden;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.map-container::after {\r\n\t\tcontent: '电子围栏区域';\r\n\t\tposition: absolute;\r\n\t\tbottom: 10rpx;\r\n\t\tright: 10rpx;\r\n\t\tbackground: rgba(0, 0, 0, 0.6);\r\n\t\tcolor: white;\r\n\t\tpadding: 8rpx 16rpx;\r\n\t\tborder-radius: 8rpx;\r\n\t\tfont-size: 24rpx;\r\n\t}\r\n\r\n\t.countdown-container {\r\n\t\tpadding: 20rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 10rpx;\r\n\t\tmargin: 20rpx;\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.countdown-text {\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #1890ff;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t/* 全局样式 */\r\n\t.container {\r\n\t\tpadding: 20rpx;\r\n\t\tbackground-color: #f5f7fa;\r\n\t\tmin-height: 100vh;\r\n\t}\r\n\r\n\t/* 页面标题 */\r\n\t.page-header {\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tpadding: 20rpx 0;\r\n\t}\r\n\r\n\t.page-title {\r\n\t\tfont-size: 36rpx;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #333;\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t/* 卡片样式 */\r\n\t.detail-card {\r\n\t\tbackground-color: white;\r\n\t\tborder-radius: 16rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\toverflow: hidden;\r\n\t\tbox-shadow: none;\r\n\t\tborder: none;\r\n\t}\r\n\r\n\t.detail-header {\r\n\t\tpadding: 20rpx;\r\n\t}\r\n\r\n\t.detail-label {\r\n\t\tfont-size: 28rpx;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.detail-content {\r\n\t\tpadding: 20rpx;\r\n\t}\r\n\r\n\t.detail-value {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #666;\r\n\t\tword-break: break-all;\r\n\t}\r\n\r\n\t.detail-text {\r\n\t\tline-height: 1.6;\r\n\t}\r\n\r\n\t/* 图片样式 */\r\n\t.image-container {\r\n\t\twidth: 100%;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.detail-image {\r\n\t\twidth: 100%;\r\n\t\tborder-radius: 8rpx;\r\n\t\tmargin: 10rpx 0;\r\n\t}\r\n\r\n\t.placeholder-image {\r\n\t\twidth: 100%;\r\n\t\theight: 300rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tborder-radius: 8rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.placeholder-text {\r\n\t\tcolor: #999;\r\n\t\tfont-size: 24rpx;\r\n\t}\r\n\r\n\t/* 上传区域样式 */\r\n\t.upload-container {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.upload-area {\r\n\t\twidth: 100%;\r\n\t\theight: 200rpx;\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tborder-radius: 8rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\talign-items: center;\r\n\t\tborder: 2rpx dashed #ccc;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\r\n\t.upload-text {\r\n\t\tcolor: #999;\r\n\t\tfont-size: 24rpx;\r\n\t}\r\n\r\n\t.repair-image-container {\r\n\t\twidth: 100%;\r\n\t}\r\n\r\n\t.repair-image {\r\n\t\twidth: 100%;\r\n\t\tborder-radius: 8rpx;\r\n\t}\r\n\r\n\t/* 状态样式 */\r\n\t.status-badge {\r\n\t\tpadding: 12rpx 24rpx;\r\n\t\tborder-radius: 30rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tfont-weight: bold;\r\n\t\tdisplay: inline-block;\r\n\t\tbox-shadow: none;\r\n\t}\r\n\r\n\t.status-cancel {\r\n\t\tbackground-color: #f5f5f5;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.status-pending {\r\n\t\tbackground-color: #fff7e6;\r\n\t\tcolor: #fa8c16;\r\n\t}\r\n\r\n\t.status-processing {\r\n\t\tbackground-color: #e6f7ff;\r\n\t\tcolor: #1890ff;\r\n\t}\r\n\r\n\t.status-complete {\r\n\t\tbackground-color: #f6ffed;\r\n\t\tcolor: #52c41a;\r\n\t}\r\n\r\n\t/* 按钮样式 */\r\n\t.action-button-container {\r\n\t\tmargin: 40rpx 0;\r\n\t}\r\n\r\n\t.action-button {\r\n\t\tbackground: linear-gradient(to right, #1890ff, #40a9ff);\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tborder-radius: 8rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tpadding: 16rpx 0;\r\n\t\twidth: 100%;\r\n\t\tbox-shadow: 0 4rpx 12rpx rgba(24, 144, 255, 0.3);\r\n\t\ttransition: transform 0.2s, box-shadow 0.2s;\r\n\t}\r\n\r\n\t.action-button-hover {\r\n\t\ttransform: translateY(2rpx);\r\n\t\tbox-shadow: 0 2rpx 8rpx rgba(24, 144, 255, 0.2);\r\n\t}\r\n</style>","import MiniProgramPage from 'D:/app/om-engineer/pages/rtestOrder/rtestOrder.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","baseConfig"],"mappings":"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"}